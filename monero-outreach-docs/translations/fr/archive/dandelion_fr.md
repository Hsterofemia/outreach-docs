# Dandelion++ pour Monero

**"Dandelion++ empêche les mauvais acteurs d'associer votre adresse IP à vos transactions Monero." - 2 mars, 2020**

Monero est soutenu par son réseau de communication pair à pair (P2P). Les ordinateurs qui sous-tendent le réseau par leur connaissance de la chaîne de blocs — appelés noeuds — partagent l'information qui rend l'utilisation de Monero possible: les adresses de nœuds, l'historique de la chaîne de blocs, les nouveaux blocs minés, et les nouvelles transactions à ajouter aux blocs. Les nœuds sont toutefois identifiées selon leur adresse de Protocole Internet ("Internet Protocol" — IP — en anglais) exposant le réseau au risque d'associations entre les adresses IP et les transactions, qui provoqueraient une perte de l'anonymité des transaction et de l'information qu'elles renferment. Dandelion++ est une méthode pour cacher cette connexion, planifiée pour une prochaine mise à jour du logiciel de Monero. Cet article explique le fonctionnement de Dandelion++ et comment les usagers de Monero en bénéficieront.

### Le Réseau P2P de monero

Monero possède deux éléments conceptuels: 1) un réseau P2P et 2) des applications qui s'exécutent sur ce réseau. Les applications gèrent les adresses, les clés et les transactions, tandis que le réseau organise l'information et s'assure de la transmission des données. Pour bien comprendre Dandelion++, il est pertinent de considérer la structure du réseau P2P ainsi que la manière dont les portefeuilles s'en servent pour communiquer les transactions.

Sa structure comprend des milliers de nœuds répartis de par la planète — des dizaines de milliers si on compte les nœuds passifs — chacun connecté, via Internet, habituellement à un petit groupe d'autres nœuds appelés pairs [1]. Les nœuds communiquent avec leurs pairs en utilisant le même protocole TCP ("Transmission Control Protocol" - Protocole de Contrôle de Transmission) utilisé par les navigateurs et les serveurs Web. Les pairs d'un nœud paraissent aléatoires et n'ont pas besoin de rapprochement géographique. Un nombre commun de pairs est huit, mais certains nœuds en ont des centaines. Chaque nœud trouve ses pairs en envoyant d'abord une requête à un nœud maître pour sa liste de pairs, pour ensuite envoyer la même requête aux pairs de cette liste, et ainsi de suite. Le résultat est un réseau de plusieurs ordinateurs, chacun communicant par TCP avec au mieux une visibilité partielle et limitée du réseau entier.

Ces nœuds agissent comme un portail pour permettre au portefeuilles de communiquer avec le réseau P2P. Certains portefeuilles, comme le portefeuille GUI officiel, peuvent exécuter leur propre nœud, tandis que d'autres, comme MyMonero sur un téléphone intelligent (smartphone), utilisent toujours un nœud distant. Les portefeuilles dépensent Monero en créant et diffusant une transaction via son nœud portail, afin que la transaction trouve ultimement son chemin vers le nœud d'un mineur pour être incluse dans un bloc miné. Chaque transaction comporte une quantité limitée d'informations, mais qui contient malgré tout des données significatives, incluant un ensemble de sources possibles des fonds dépensés.

Présentement, le nœud Monero qui entreprend la diffusion d'une nouvelle transaction utilise un procédé appelé "flooding". Il communique la transaction à tous ses pairs, qui la communiquent ensuite à tous leurs pairs, et ainsi de suite, sous l'égide d'un mécanisme de vérification qui empêche la communication redondante. L'information se propage dans toutes les directions sur le réseau, comme une vague. Certaines cryptomonnaies, comme Bitcoin, rendent aléatoire ces émissions, mais pas Monero.

### Le Problème

Votre adresse IP en dit long sur vous. Pour un échantillon de ce qui est connu à propos de votre adresse IP, vous pouvez visiter in site d'information IP tel que [whatismyipaddress.com](https://whatismyipaddress.com/). Avec de l'information de votre fournisseur de service internet (ISP) ou fournisseur de réseau virtuel privé (VPN), selon le cas, votre adresse IP pourrait carrément permettre de déterminer votre nom. Toute connexion entre votre adresse IP et la transaction que vous créez est source d'information - même l'acte d'effectuer une transaction est probablement quelque chose que vous avez intérêt à garder caché. Le problème ici est que la transmission des transactions par "flooding" sur le réseau P2P de Monero permet justement à un observateur d'associer la transaction à votre adresse IP [2].

L'association d'une adresse IP à une transaction n'est pas facile, ni certaine. Il faut plusieurs observateurs et beaucoup d'effort. Toutefois, l'utilisation d'un botnet (par exemple) connecté au réseau P2P de Monero permet de calculer l'origine probable d'une transaction en analysant la chronologie de la transmission et en comparant l'information connue par les autres pairs. Lorsqu'il y a un grand bruit, vous savez dans quelle direction regarder parce que votre cerveau sait déduire son origine se fiant sur le temps d'écoute et la distorsion perçue par chaque oreille. L'analyse de paquets de données de cryptomonnaie émis par "flooding" et reçus par différents nœuds permet à un adversaire observateur de faire le même exercice. La création de transaction est analogue à la création d'un fort bruit, avec le réseau de nœuds botnet agissant comme une multitude d'oreilles.

### Dandelion

Afin d'adresser ce problème, une équipe de chercheurs de l'Université de l'Illinois ont d'abord développé un ensemble de techniques qu'ils ont appelé Dandelion [2]. L'application devait être pour Bitcoin, mais Dandelion s'applique également à Monero. Le principe de Dandelion est de router, en premier lieu, les transactions à un nœud distant d'une manière spéciale et indétectable avant d'initier la propagation par "flooding".

Les auteurs de Dandelion ont plongé dans les aspects théoriques et pratiques de l'utilisation de botnets pour retracer les sources de transactions de cryptomonnaies. Cet effort a abouti à plusieurs résultats, dont la création de modèles mathématiques pour quantifier et mesurer l'anonymat (voir [2] pour plus d'information), qui ont été utilisés pour analyser trois approches de propagation des transactions sur un réseau de cryptomonnaie: 1) le "flooding" de base (la méthode de Monero), 2) un "flooding" aléatoire, appelé diffusion (la méthode de Bitcoin), et 3) la diffusion par proxy. Cette dernière approche transmet d'abord la transaction à un nœud aléatoire, qui la propage ensuite par la méthode de diffusion. Les trois techniques ont ultimement été jugées inadéquates selon les modèles mathématiques des chercheurs.

Pour adresser cette insuffisance, les auteurs ont proposé Dandelion. Dandelion définit un procédé qu'on appelle la phase d'anonymité (ou la phase tige - "stem" en anglais), afin de trouver un nœud proxy qui effectuera la transmission. L'outil établit un second procédé pour l'émission, appelé la phase de dispersion ("spread" ou "fluff" en anglais). En général, les deux phases font appel à un ensemble de pairs différent, avec la différence marquée que l'ensemble de connexions pour la phase d'anonymité change avec le temps. Le nom Dandelion nous vient du procédé où, dans un premier temps, le système trouve un nœud proxy selon un chemin de recherche particulier et linéaire, puis à partir de ce nœud proxy le système propage l'information rapidement et symétriquement-la forme de la propagation d'information ressemble à une fleur de pissenlit ("Dandelion" en anglais).

Analysé avec les modèles mathématiques des chercheurs, Dandelion s'avère résistant à une situation où un ensemble de nœuds agissent comme observateurs passifs (à condition que tous les nœuds du réseau utilisent Dandelion). Dans un réseau avec Dandelion, un botnet participant honnêtement au réseau P2P ne peut pas associer des transactions à des adresses IP de manière fiable.

### Dandelion++

Toutefois, un adversaire qui cherche à lier des transactions à des adresses IP pourrait ne pas être passif, et pourrait carrément ignorer les règles du réseau. Des nœuds honnêtes pourraient aussi ne pas utiliser Dandelion. Motivés par l'essor du marché pour l'analyse de cryptomonnaie à portée large, comme par Chainalysis [4], les auteurs ont revisité les présomptions de leur premier travail et, avec des collaborateurs, ont donné naissance une année plus tard à Dandelion++ [3]. Dandelion++ apporte des petits changements à Dandelion pour résister aux attaques à grande échelle cherchant à défaire l'anonymat des transactions en ignorant les règles du réseau et en agissant de mauvaise foi.

Les créateurs de Dandelion++ ont modélisé le comportement d'un adversaire tel un botnet avec des nœuds espions distribués de par le réseau, et qui formerait une fraction importante du réseau total. Dans leur modèle, ces noeuds ne sont pas obligés de suivre les règles du réseau. Ils peuvent générer des connexions sortantes à des noeuds honnêtes ou adversaires comme bon leur semble. Ils peuvent utiliser toute l'information disponible, incluant le synchronisme et les adresses des émetteurs. C'est dans cet environnement extrême et hostile que Dandelion++ réussit à conserver l'anonymat du réseau.

Dandelion++, comme Dandelion, possède une phase tige (recherche d'un nœud proxy) et une phase de dispersion (émission symétrique de la transaction à tous les nœuds). Afin d'implémenter une connectivité dynamique dans la nouvelle phase tige, le système procède en intervalles discrets, appelés époques. Chaque nœud change d'époque de manière indépendante, typiquement après quelques minutes. Avec chaque nouvelle époque un nœud choisit aléatoirement deux nouvelles connexions-relais à partir de ses connexions de sortie. Ensuite, lorsque le nœud crée sa propre transaction, il l'envoie par l'entremise d'une de ces deux connexions-relais, opérant toujours le même choix pendant une époque donnée. Lorsque le nœud reçoit, d'un autre nœud, une transaction pour retransmission lors de la phase tige, il le retransmet par une des deux connexions-relais (choisies aléatoirement) s'il est désigné relayeur (plus d'information suivra concernant ce dernier concept).

La phase de dispersion dans Dandelion++ utilise la diffusion, le procédé "flooding" où la chronologie des communication est aléatoire afin de rendre la vie difficile aux nœuds observateurs qui voudraient identifier la source. Lorsqu'une transaction a entamé le processus de diffusion, elle continue de se propager en utilisant le mode diffusion, ne retournant jamais à la phase tige. La diffusion débute toutefois d'une manière particulière avec Dandelion++. Pour chaque époque, un nœud se classifie comme étant relayeur ou diffuseur. Le mode est déterminé de manière aléatoire au début de chaque époque. Si un nœud est diffuseur, lorsqu'il reçoit une transaction à relayer en phase tige, il procède à son émission en utilisant le mode diffusion, entamant ainsi la phase de dispersion.

Il y a un élément additionnel et complémentaire de Dandelion++ appelé mécanisme à sûreté intégrée. Chaque nœud qui relaye une transaction pendant la phase tige démarre un décompte pour cette transaction. Si un lapse de temps prédéterminé s'écoule sans que le nœud ne reçoive la même transaction en retour pendant la phase de dispersion, il démarre sa propre phase de dispersion. Ce mécanisme sert deux objectifs: il frustre toute tentative de défaire l'anonymité en utilisant la chronologie des transmission, et il empêche les attaques dites trou noir où des nœuds malveillants détruisent les transactions pendant la phase tige plutôt que les relayer.

Grâce à ces techniques, Dandelion++ fournit une garantie formelle de résistance aux attaques à l'anonymité du réseau. Cette fin est atteinte en utilisant des techniques locales, contrairement au réseau Tor qui s'appuie un raisonnement global. Chaque nœud Dandelion++ se comporte selon sa propre logique interne. Le résultat est une technique rapide, efficiente et efficace pour empêcher l'association d'adresses IP aux transaction par les acteurs les plus sophistiqués.

### Intégration avec monero

Bien que Dandelion++ ait été développé explicitement pour Bitcoin, il a été intégré à Monero récemment par le développeur Lee Clagett (vtnerd), avec les essais et la revue faite par le développeur moneromooo. Les discussions et les changements apportés par ces éminents développeurs peuvent être vus avec les "pull request" au code source [5]. Le pull request fait partie du processus formel par lequel du nouveau code entre dans le code de base de Monero. Bien que le pull request pour Dandelion++ ait été approuvé par moneromooo, au moment d'écrire ces lignes le processus de revue n'est pas terminé et l'outil n'a pas été intégré au code de base de Monero.

Lorsqu'intégré, Dandelion++ sera utilisé par défaut. Il sera toujours possible de désactiver l'outil en fixant la probabilité d'entrer en phase de dispersion à 100% dans le fichier code C++ cryptonote_config.h et de recompiler le code. Même dans ce cas de désactivation délibérée, le réseau Monero utilisera la diffusion, avec des délais aléatoires, plutôt que l'émission par "flooding". La date de lancement de l'outil n'est pas encore fixée. L'addition de Dandelion++ ne nécessite pas un embranchement divergent.

Il existe quelques désavantages et limitations. Dandelion++ ajoute un délai à la propagation des transactions. Ceci est causé par plusieurs sources, qui sont abordées par les auteurs de Dandelion++ [3]. Premièrement, l'existence de la phase tige ajoute un délai, possiblement quelques secondes si on se fie aux analyses et évaluations expérimentales des auteurs. La diffusion ajoute des délais aléatoires lors de la phase de dispersion, typiquement moins d'une seconde. En cas d'attaque trou noir sur le réseau, l'attente de confirmation par l'initiateur pourrait retarder la transmission par un délai de plus d'une minute. Ces délais ne devraient pas affecter outre mesure le réseau. De plus, Dandelion++ n'encrypte pas les paquets P2P, et ne protège pas contre un espionnage de l'ISP ou du VPN - pour contrer ce type d'espionnage, vous pouvez utiliser Tor.

[1] L'exploration du réseau pair à pair de Monero (Exploring the Monero Peer-to-Peer Network), T. Cao, J. Yu, J. Decouchant, X Luo, and P. Verissimo, [eprint.iacr.org/2019/411.pdf](https://eprint.iacr.org/2019/411.pdf).  
[2] Dandelion: Reconcevoir le Réseau Bitcoin pour l'Anonymat (Dandelion: Redesigning the Bitcoin Network for Anonymity), S.B. Venkatakrishan, G. Fanti, and P. Viswanath, SIGMETRICS ’17, June 5-9, 2017, Urbana-Champaign, [publish.illinois.edu/science-of-security-lablet/files/2016/07/Dandelion-Redesigning-BitCoin-Networking-for-Anonymity.pdf](http://publish.illinois.edu/science-of-security-lablet/files/2016/07/Dandelion-Redesigning-BitCoin-Networking-for-Anonymity.pdf)  
[3] Dandelion++: Réseaux Allégés pour la Cryptomonnaie avec Garanties Formelles d'Anonymat (Dandelion++: Lightweight Cryptocurrency Networking with Formal Anonymity Guarantees), G. Fanti, S.B. Venkatakrishnan, S. Bakshi, B. Denby, S. Bhargava, A. Miller, and P. Viswanath, arXiv:1805.11060v1, May 28, 2018, [arxiv.org/pdf/1805.11060.pdf](https://arxiv.org/pdf/1805.11060.pdf)  
[4] Chainalysis, [chainalysis.com](https://www.chainalysis.com/).  
[5] Ajouter un Soutien à Dandelion++ aux Réseaux Publiques (Adding Dandelion++ support to public networks) : #6314, [github.com/monero-project/monero/pull/6314](https://github.com/monero-project/monero/pull/6314).

### Sommaire

Un outil puissant pour contrer les tentatives d'atteinte à l'anonymat de Monéro s'en vient: Dandelion++. Cette méthode, initialement développée pour Bitcoin et intégrée à Monero par le développeur Lee Clagett, empêche les adversaires de lier les adresses IP aux transactions Monero - même en cas d'attaques sophistiquées et à grande échelle. L'outil s'attarde surtout à la résistance aux botnet. Dandelion++ utilise les phases tige et de dispersion qui donnent au flux d'information l'apparence d'une fleur de pissenlit, d'où le nom. L'outil rend très difficile l'identification de la source d'une transaction par un observateur. Cette fonctionnalité, merveilleuse et élégante, rehaussera les capacités d'anonymat déjà excellentes du réseau Monero et fait progresser la cryptomonnaie dans sa quête continuelle d'amélioration.

### En Savoir plus

- Lee Clagett à Monero Konferenco: [Dandelion Onions: Protecting Transaction Privacy in Monero](https://www.monerooutreach.org/monero-konferenco/lee-clagett.html)
